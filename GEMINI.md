# Gemini CLI 协作准则 (正式开源项目模式)

## 项目定位
- 项目名称：**Modular Agent CLI**。
- 目标：构建一个模块化、可扩展、生产级别的 LangGraph 智能体 CLI 工具。
- 主要受众：**中文开发者社区**。

## 协作准则 (Agent 行为规范)
1. **稳健开发**：在修改 `agent_core` 等核心代码前，需详细排查现有逻辑，严禁随意删除或破坏已有的稳健逻辑。
2. **测试保障**：新增功能或修改代码后，必须运行 `tests/` 目录下的测试脚本，确保现有功能不被破坏（确保无回归 Bug）。
3. **中文优先 (重点)**：
   - **代码注释**：所有新增或修改的代码，其注释必须使用简洁、专业的**中文**。
   - **文档编写**：README、技能说明（SKILL.md）以及代码中的 Docstrings 必须以中文为主，确保对中文用户友好。
4. **开源规范**：
   - 遵循 Python PEP 8 代码风格规范。
   - 严禁将 API Keys、个人隐私信息、本地绝对路径等内容硬编码在代码或提交记录中。
5. **版本管理**：
   - 保持 Git 提交记录的语义化与整洁。
   - 关键操作前建议先向用户确认。
6. **架构分层严守 (反省)**：
   - **关注点分离**：`tools.py` 仅允许存放直接暴露给 LLM 的 `@tool` 函数。
   - **拒绝惰性开发**：严禁将系统级辅助逻辑（如文件扫描、YAML 解析、配置加载）混入工具层，必须剥离至 `utils.py` 或独立模块。
   - **先思考再落笔**：新增功能时，必须先评估其在架构中的位置，而非为了省事就近编写。

## 用户与背景记忆
- 用户名：宁可
- 核心进展：
  - **[2026-01-29] 架构中立化与办公自动化实战**：
    - **多模型提供商支持**：通过环境变量 (`LLM_MODEL_NAME`, `LLM_BASE_URL`, `LLM_API_KEY`) 彻底解耦模型提供商，成功实现向 DeepSeek (火山引擎 Ark) 的平滑切换。
    - **PPT 自动化技能落地**：新建 `ppt_master` 技能，实现 Markdown 剧本 -> 企业级 PPTX 的转换。支持自动清空模板、智能版式匹配以及“图示建议”视觉占位。
    - **UI 交互增强**：
        - 优化 `main.py` 循环，实时回显 `ToolMessage` 结果预览。
        - 引入消息去重机制 (`seen_message_ids`) 和正则清洗，彻底解决 DeepSeek 模型思考内容重复打印的问题，提升交互清爽度。
  - **[2026-01-29] 迈向“工匠”：原子能力与强安全拦截**：
    - **原子能力 (Atomic Tools)**：新增 `read_file` 和 `write_file`，使 Agent 具备直接读写文件的能力，不再完全依赖 Shell 脚本。
    - **代码层拦截 (Hard Guardrail)**：在 `nodes.py` 中部署物理拦截逻辑，强制阻止“并行读写”和“激活即执行”的抢跑行为，确保 Agent 逻辑严密。
    - **测试完备**：新增 `tests/test_atomic_tools.py` 并通过全量回归测试。
  - **[2026-01-28] 架构与规范重构（重要修正）**：
    - **架构修正**：将 `get_available_skills_list` 从 `tools.py` 剥离至 `utils.py`，纠正了“工具层与工具逻辑混杂”的架构失误。
    - **交互升级**：引入 `prompt_toolkit`，完美解决 CLI 中文输入卡顿与历史记录问题。
    - **XML Prompt**：全面采用 Gemini CLI 风格的 XML 结构化 System Prompt，并实现技能自动发现。
  - **[2026-01-28] 架构全面升级（里程碑）**：
    - **思维透明化**、**环境自修复**、**严格串行执行** 三大特性落地。
  - **[2026-01-28] 文档与国际化**：核心代码全中文注释，README 重构。
  - **[2026-01-27]** 验证多技能槽位与联动工作流。